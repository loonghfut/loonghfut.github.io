---
layout: default
---

<a href="{{ '/' | relative_url }}" class="back-link">â† è¿”å›é¦–é¡µ</a>

<article class="content">
  {% if page.featured_image %}
  <img src="{{ page.featured_image }}" alt="{{ page.title }}" class="featured-image">
  {% endif %}
  
  <div class="article-header">
    <h2>{{ page.title }}</h2>
    
    <div class="article-meta">
      {% if page.date %}
      <span class="article-meta-item">
        ğŸ“… å‘å¸ƒ: {{ page.date | date: "%Yå¹´%mæœˆ%dæ—¥" }}
      </span>
      {% endif %}
      
      {% if page.lastmod %}
      <span class="article-meta-item">
        ğŸ”„ æ›´æ–°: {{ page.lastmod | date: "%Yå¹´%mæœˆ%dæ—¥" }}
      </span>
      {% endif %}
    </div>
  </div>
  
  <div class="post-content">
    <aside class="toc-wrapper">
      <nav class="toc">
        <div class="toc-header">
          <h3>ğŸ“‘ ç›®å½•</h3>
          <button class="toc-toggle" aria-label="Toggle table of contents">
            <span class="toc-toggle-icon">â–¼</span>
          </button>
        </div>
        <div id="toc-content"></div>
      </nav>
    </aside>
    
    <div class="article-body">
      {{ content }}
    </div>
  </div>
</article>

<script>
  // Detect and move header image (Notion-style)
  (function() {
    const articleBody = document.querySelector('.article-body');
    const articleHeader = document.querySelector('.article-header');
    
    if (!articleBody || !articleHeader || !articleHeader.parentElement) return;
    
    // Find the first image in article body
    const firstImg = articleBody.querySelector('img');
    
    if (firstImg) {
      // Check if the image is at the very beginning (first or second element)
      const firstElements = Array.from(articleBody.children).slice(0, 2);
      const imgParent = firstImg.parentElement;
      
      // If image is in the first two elements, treat it as a header image
      if (firstElements.includes(firstImg) || firstElements.includes(imgParent)) {
        // Create header image container
        const headerImageContainer = document.createElement('div');
        headerImageContainer.className = 'notion-header-image';
        
        // Clone the image
        const headerImg = firstImg.cloneNode(true);
        headerImageContainer.appendChild(headerImg);
        
        // Insert before article header
        articleHeader.parentElement.insertBefore(headerImageContainer, articleHeader);
        
        // Remove original image from article body
        if (imgParent.tagName === 'P' && imgParent.children.length === 1) {
          imgParent.remove();
        } else {
          firstImg.remove();
        }
      }
    }
  })();

  // Generate table of contents
  (function() {
    const articleBody = document.querySelector('.article-body');
    const tocContent = document.getElementById('toc-content');
    const tocWrapper = document.querySelector('.toc-wrapper');
    
    if (!articleBody || !tocContent) return;
    
    const headings = articleBody.querySelectorAll('h1, h2, h3, h4, h5, h6');
    
    if (headings.length === 0) {
      // If no headings, hide the TOC
      tocWrapper.style.display = 'none';
      document.querySelector('.post-content').style.gridTemplateColumns = '1fr';
      return;
    }
    
    const toc = document.createElement('ul');
    let currentLevel = parseInt(headings[0].tagName.substring(1));
    let currentList = toc;
    const listStack = [toc];
    
    headings.forEach((heading, index) => {
      const level = parseInt(heading.tagName.substring(1));
      const id = heading.id || `heading-${index}`;
      heading.id = id;
      
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = `#${id}`;
      a.textContent = heading.textContent;
      li.appendChild(a);
      
      if (level > currentLevel) {
        const ul = document.createElement('ul');
        if (currentList.lastElementChild) {
          currentList.lastElementChild.appendChild(ul);
        }
        currentList = ul;
        listStack.push(ul);
      } else if (level < currentLevel) {
        while (listStack.length > 1 && level < currentLevel) {
          listStack.pop();
          currentList = listStack[listStack.length - 1];
          currentLevel--;
        }
      }
      
      currentList.appendChild(li);
      currentLevel = level;
    });
    
    tocContent.appendChild(toc);
    
    // Smooth scroll
    tocContent.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const target = document.querySelector(link.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });
    
    // TOC collapse/expand functionality
    const tocToggle = document.querySelector('.toc-toggle');
    const tocIcon = document.querySelector('.toc-toggle-icon');
    const postContentEl = document.querySelector('.post-content');

    // Load saved state from localStorage
    const tocCollapsed = localStorage.getItem('toc-collapsed') === 'true';
    if (tocCollapsed) {
      tocContent.classList.add('collapsed');
      if (postContentEl) postContentEl.classList.add('toc-collapsed');
      tocIcon.textContent = 'â–¶';
    }

    tocToggle.addEventListener('click', () => {
      const isCollapsed = tocContent.classList.contains('collapsed');

      if (isCollapsed) {
        tocContent.classList.remove('collapsed');
        if (postContentEl) postContentEl.classList.remove('toc-collapsed');
        tocIcon.textContent = 'â–¼';
        localStorage.setItem('toc-collapsed', 'false');
      } else {
        tocContent.classList.add('collapsed');
        if (postContentEl) postContentEl.classList.add('toc-collapsed');
        tocIcon.textContent = 'â–¶';
        localStorage.setItem('toc-collapsed', 'true');
      }
    });
  })();
</script>
